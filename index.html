<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>Admission Tools & Luiss Prep</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéì</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #F5F5F7;
            --card-bg: #FFFFFF;
            --primary: #0071E3;
            --text-main: #1D1D1F;
            --text-sec: #86868B;
            --text-light: #C7C7CC;
            --border-light: #D2D2D7;
            --input-bg: #F5F5F7;
            --radius-xl: 24px;
            --radius-m: 14px;
            --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.04);
            
            /* Status Colors */
            --success: #34C759;
            --success-bg: #E8FCE8;
            --warning: #FF9F0A;
            --warning-bg: #FFF5E5;
            --danger: #FF3B30;
            --danger-bg: #FFF0F0;
            --whatsapp: #25D366;
            --whatsapp-bg: #E7FCEB;
            
            /* Luiss Colors */
            --luiss-blue: #00338D; 
            --luiss-light: #Eef4ff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 20px 16px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            position: relative;
            padding-bottom: 40px;
        }

        /* --- VIEWS --- */
        .view-section {
            display: none;
            width: 100%;
            will-change: opacity, transform;
        }
        .view-section.active {
            display: block;
            animation: fadeIn 0.3s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }
        
        @keyframes fadeIn { from{opacity:0; transform: translateY(8px);} to{opacity:1; transform: translateY(0);} }

        /* --- CARDS & MENU --- */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            padding: 24px;
            box-shadow: var(--shadow-card);
            margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.02);
            position: relative;
            z-index: 10;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            margin-bottom: 16px;
            cursor: pointer;
            box-shadow: var(--shadow-card);
            border: 1px solid rgba(0,0,0,0.02);
            user-select: none;
            position: relative;
            z-index: 20;
            transform: scale(1);
            transition: transform 0.1s ease-out, background 0.2s;
            text-decoration: none; /* Per i link avvolti */
        }
        .menu-item:active { transform: scale(0.98); background: #f9f9f9; }

        .menu-icon {
            font-size: 22px;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
            font-weight: 700;
        }

        .menu-content h3 {
            margin: 0 0 4px 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-main);
        }
        .menu-content p {
            margin: 0;
            font-size: 13px;
            color: var(--text-sec);
            line-height: 1.4;
        }

        /* --- HEADER --- */
        .nav-header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
            padding: 0 4px;
        }
        .back-btn {
            background: #E5E5EA;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-main);
            cursor: pointer;
            margin-right: 16px;
            transition: transform 0.1s;
        }
        .back-btn:active { transform: scale(0.9); }
        
        .page-title {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* --- INPUTS --- */
        .input-group { margin-bottom: 20px; }
        label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-sec);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding-left: 4px;
        }
        .input-box {
            width: 100%;
            height: 52px;
            padding: 0 16px;
            font-size: 16px;
            font-family: inherit;
            font-weight: 500;
            background: var(--input-bg);
            border: none;
            border-radius: 14px;
            color: var(--text-main);
            outline: none;
            transition: box-shadow 0.2s;
        }
        .input-box:focus {
            box-shadow: 0 0 0 2px var(--primary) inset;
            background: #fff;
        }

        /* --- PREDICTOR STYLES --- */
        .result-container {
            margin-top: 28px;
            padding-top: 24px;
            border-top: 1px solid #E5E5EA;
            display: none;
        }
        .result-badge {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            display: block;
        }
        .result-main {
            font-size: 22px;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 8px;
            color: var(--text-main);
        }
        .result-sub {
            font-size: 15px;
            color: var(--text-sec);
            line-height: 1.5;
            margin-bottom: 16px;
        }
        .data-match-box {
            background: #F2F2F7;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            display: none;
        }
        .match-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            margin-left: 6px;
            text-transform: uppercase;
        }
        .tag-ok { background: #D1FAE5; color: #065F46; }
        .tag-ko { background: #FEE2E2; color: #991B1B; }

        /* --- QUIZ STYLES --- */
        .luiss-header {
            background: var(--luiss-light);
            border-radius: 16px;
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--luiss-blue);
            box-shadow: inset 0 0 0 1px rgba(0, 51, 141, 0.08);
        }
        .abort-btn {
            background: transparent;
            border: none;
            font-size: 20px;
            color: var(--text-sec);
            cursor: pointer;
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }
        .abort-btn:active { background: rgba(0,0,0,0.05); color: var(--danger); }

        .timer-badge {
            font-variant-numeric: tabular-nums;
            font-weight: 700;
            font-size: 15px;
            background: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            color: var(--luiss-blue);
        }
        
        .reading-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-main);
            background: var(--input-bg);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            border-left: 4px solid var(--luiss-blue);
            max-height: 200px;
            overflow-y: auto;
        }

        .question-text {
            font-size: 17px;
            font-weight: 600;
            line-height: 1.4;
            margin-bottom: 24px;
            color: var(--text-main);
        }

        .quiz-opt-btn {
            background: var(--input-bg);
            padding: 18px;
            border-radius: 16px;
            margin-bottom: 12px;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-main);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: flex-start;
            border: 2px solid transparent;
        }
        .quiz-opt-btn:active { transform: scale(0.98); }
        .quiz-opt-btn.selected { 
            border-color: var(--luiss-blue); 
            background: #fff; 
            box-shadow: 0 4px 12px rgba(0,51,141,0.1); 
        }
        
        .quiz-marker {
            min-width: 24px; height: 24px;
            border-radius: 50%;
            background: #fff;
            color: var(--text-sec);
            display: flex; justify-content: center; align-items: center;
            font-size: 12px; font-weight: 700;
            margin-right: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            margin-top: 0px;
            transition: background 0.2s;
        }
        .quiz-opt-btn.selected .quiz-marker { background: var(--luiss-blue); color: #fff; }

        .nav-actions { display: flex; gap: 10px; margin-top: 30px; }
        .action-btn { 
            flex: 1; 
            height: 52px; 
            border-radius: 14px; 
            border: none; 
            font-weight: 600; 
            font-size: 15px; 
            cursor: pointer; 
            transition: opacity 0.2s, transform 0.1s;
        }
        .btn-primary { background: var(--luiss-blue); color: #fff; box-shadow: 0 4px 12px rgba(0, 51, 141, 0.2); }
        .btn-primary:active { opacity: 0.9; transform: scale(0.98); }
        
        .btn-sec { 
            background: #fff; 
            color: var(--text-main); 
            border: 1px solid var(--border-light);
            box-shadow: 0 2px 6px rgba(0,0,0,0.03);
        }
        .btn-sec:active { background: #f5f5f7; transform: scale(0.98); }

        .btn-skip { background: transparent; border: 1px solid transparent; color: var(--text-sec); font-weight: 500;}
        .btn-skip:active { color: var(--text-main); }
        
        .btn-icon { flex: 0 0 52px; font-size: 20px; }

        /* --- STATS GRID --- */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin: 24px 0;
        }
        .stat-box {
            background: var(--input-bg);
            border-radius: 16px;
            padding: 16px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stat-val { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
        .stat-lbl { font-size: 10px; text-transform: uppercase; color: var(--text-sec); font-weight: 600; }

        /* --- REVIEW MODE --- */
        .review-item {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-light);
            position: relative;
            padding-left: 14px;
        }
        .review-item::before {
            content: ''; position: absolute; left: 0; top: 6px; bottom: 24px; width: 4px; border-radius: 2px; background: var(--border-light);
        }
        .review-item.status-correct::before { background: var(--success); }
        .review-item.status-wrong::before { background: var(--danger); }
        .review-item.status-skipped::before { background: var(--warning); }
        .review-q { font-weight: 600; font-size: 16px; margin-bottom: 12px; color: var(--text-main); line-height: 1.5; }
        .review-opt { font-size: 14px; padding: 10px 14px; border-radius: 10px; margin-bottom: 6px; display: flex; align-items: center; color: var(--text-sec); background: #fff; border: 1px solid rgba(0,0,0,0.05); }
        .review-opt.is-correct { background-color: var(--success-bg); color: #065F46; border-color: rgba(52, 199, 89, 0.2); font-weight: 600; }
        .review-opt.is-wrong { background-color: var(--danger-bg); color: #991B1B; border-color: rgba(255, 59, 48, 0.2); text-decoration: line-through; }

        /* --- FOOTER --- */
        .footer-info {
            margin-top: 40px;
            text-align: center;
            padding-bottom: 20px;
        }
        .footer-text {
            font-size: 12px;
            color: var(--text-sec);
            margin-bottom: 6px;
            line-height: 1.4;
        }
        .footer-link {
            font-size: 13px; /* Leggermente pi√π grande */
            color: var(--text-sec); /* Stesso grigio del disclaimer */
            font-weight: 600;
            text-decoration: none;
            display: block;
            margin-top: 12px;
            transition: color 0.2s;
        }
        .footer-link:hover { color: var(--text-main); }
    </style>
</head>
<body>

    <div class="app-container">

        <section id="view-home" class="view-section active">
            <div style="height: 20px;"></div> 
            
            <div class="menu-item" onclick="window.open('https://chat.whatsapp.com/BTgwlltgG20DlTnDXnroWC?mode=gi_t', '_blank')">
                <div class="menu-icon" style="color: var(--whatsapp); background: var(--whatsapp-bg);">üí¨</div>
                <div class="menu-content">
                    <h3>Gruppo Whatsapp Luiss</h3>
                    <p>Entra nella community candidati</p>
                </div>
            </div>

            <div class="menu-item" onclick="goTo('view-predictor')">
                <div class="menu-icon" style="color: #34C759; background: #E8FCE8;">üçÄ</div>
                <div class="menu-content">
                    <h3>Probabilit√† Ammissione Bocconi*</h3>
                    <p>Analisi dati Early Session 2025</p>
                </div>
            </div>
            
            <div class="menu-item" onclick="goTo('view-luiss-menu')">
                <div class="menu-icon" style="color: var(--luiss-blue); background: var(--luiss-light);">üéì</div>
                <div class="menu-content">
                    <h3>Prep Luiss</h3>
                    <p>10 set da 10 domande</p>
                </div>
            </div>

            <div class="footer-info">
                <div class="footer-text">Dati aggiornati alla sessione Early 2025.</div>
                <div class="footer-text">Strumento statistico non ufficiale, il sito non √® indipendente e non affiliato a Universit√† Bocconi o Universit√† Luiss Guido Carli</div>
                <a href="https://instagram.com/drissyakisoba" target="_blank" class="footer-link">ig: drissyakisoba</a>
            </div>
        </section>

        <section id="view-predictor" class="view-section">
            <div class="nav-header">
                <button class="back-btn" onclick="goTo('view-home')">‚Üê</button>
                <span class="page-title">Previsione</span>
            </div>

            <div class="card">
                <div class="input-group">
                    <label>Corso</label>
                    <select id="pred-course" class="input-box" onchange="calcPred()">
                        <option value="" disabled selected>Seleziona...</option>
                        <option value="CLEAM">CLEAM</option>
                        <option value="BIEM">BIEM</option>
                        <option value="BIEF">BIEF</option>
                        <option value="BEMACS">BEMACS</option>
                        <option value="CLEACC">CLEACC</option>
                        <option value="GLAW">Global Law</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Media Bocconi</label>
                    <input type="number" id="pred-gpa" class="input-box" placeholder="Es. 8.0" min="6" max="10" step="0.01" inputmode="decimal" oninput="calcPred()">
                </div>

                <div class="input-group">
                    <label>Punteggio Test (Opzionale)</label>
                    <input type="number" id="pred-score" class="input-box" placeholder="Es. 36.5 o 1450" inputmode="decimal" oninput="calcPred()">
                </div>

                <div id="result-area" class="result-container">
                    <span class="result-badge" id="res-badge">Analisi</span>
                    <div class="result-main" id="res-title"></div>
                    <div class="result-sub" id="res-desc"></div>

                    <div id="data-match" class="data-match-box">
                        <span class="data-match-label" style="font-size:10px; font-weight:700; color:var(--text-sec); text-transform:uppercase;">Candidato Simile (Early '25)</span>
                        <div class="data-match-val" id="match-text" style="font-size:14px; margin-top:4px;"></div>
                    </div>
                </div>
            </div>
            
            <div class="footer-info">
                <div class="footer-text" style="color: var(--text-main); font-weight: 500;">
                    * Disclaimer Importante
                </div>
                <div class="footer-text" style="max-width: 320px; margin: 0 auto;">
                    Questa stima si basa sui dati della Early Session. √à uno strumento statistico non ufficiale.
                </div>
            </div>
        </section>

        <section id="view-luiss-menu" class="view-section">
            <div class="nav-header">
                <button class="back-btn" onclick="goTo('view-home')">‚Üê</button>
                <span class="page-title" style="color: var(--luiss-blue);">Prep Luiss</span>
            </div>

            <div style="padding: 0 8px 24px 8px;">
                 <p style="margin:0; color:var(--text-sec); font-size:14px; line-height:1.5;">
                    Ogni set contiene 10 domande da svolgere in 15 minuti. Gli esercizi presentano una difficolt√† maggiore per allenare la velocit√† e la gestione dello stress. In caso di errori del sito, si invita alla segnalazione nel gruppo Whatsapp
                </p>
            </div>

            <div id="sets-container">
                </div>
        </section>

        <section id="view-luiss-quiz" class="view-section">
            <div class="luiss-header">
                <button class="abort-btn" onclick="abortQuiz()">‚úï</button>
                <span id="quiz-progress" style="font-weight:600; font-size:14px;">1 / 10</span>
                <span id="quiz-timer" class="timer-badge">15:00</span>
            </div>

            <div class="card">
                <div id="luiss-reading-text" class="reading-text" style="display:none;"></div>
                
                <div id="luiss-q-text" class="question-text">Caricamento...</div>
                <div id="luiss-options"></div>
                
                <div class="nav-actions">
                    <button id="btn-prev" class="action-btn btn-sec btn-icon" onclick="prevQuestion()">‚Üê</button>
                    <button class="action-btn btn-skip" onclick="skipLuissQuestion()">Salta</button>
                    <button class="action-btn btn-primary" onclick="submitLuissAnswer()">Conferma</button>
                </div>
            </div>
        </section>

        <section id="view-luiss-result" class="view-section">
            <div class="nav-header">
                <button class="back-btn" onclick="goTo('view-luiss-menu')">‚Üê</button>
                <span class="page-title" style="color: var(--luiss-blue);">Risultato</span>
            </div>
            
            <div class="card" style="text-align:center;">
                <div class="result-badge" style="color: var(--text-sec);">Punteggio Totale</div>
                <div class="result-main" id="final-score-title" style="font-size:48px; margin: 10px 0; color:var(--luiss-blue);">0/10</div>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-val" id="stat-correct" style="color:var(--success);">0</div>
                        <div class="stat-lbl">Corrette</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-val" id="stat-wrong" style="color:var(--danger);">0</div>
                        <div class="stat-lbl">Errate</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-val" id="stat-skipped" style="color:var(--warning);">0</div>
                        <div class="stat-lbl">Saltate</div>
                    </div>
                </div>

                <p class="result-sub" id="final-score-msg" style="margin-top:20px; padding: 0 10px;">Messaggio</p>
                
                <div style="display:flex; flex-direction:column; gap:12px; margin-top:32px;">
                    <button class="action-btn btn-sec" onclick="showReview()">Visualizza Correzioni</button>
                    <button class="action-btn btn-primary" onclick="goTo('view-luiss-menu')">Torna al Menu</button>
                </div>
            </div>
        </section>

        <section id="view-luiss-review" class="view-section">
            <div class="nav-header">
                <button class="back-btn" onclick="goTo('view-luiss-result')">‚Üê</button>
                <span class="page-title" style="color: var(--luiss-blue);">Revisione</span>
            </div>
            
            <div class="card" id="review-container" style="padding:24px 0; background:transparent; box-shadow:none; border:none;">
            </div>
             <button class="action-btn btn-sec" style="width:100%; margin-bottom:40px; background:#fff;" onclick="goTo('view-luiss-menu')">Chiudi Revisione</button>
        </section>

    </div>

    <script>
        // --- NAVIGATION MANAGER ---
        let isQuizActive = false;

        function goTo(id) {
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.remove('active');
                el.style.display = 'none';
            });
            const target = document.getElementById(id);
            if(target) {
                target.style.display = 'block';
                requestAnimationFrame(() => { target.classList.add('active'); });
            }
            window.scrollTo(0,0);
        }

        // --- CONVERTER HELPER ---
        const ANCHORS = [{b:17,s:1050},{b:25,s:1240},{b:30,s:1350},{b:35,s:1440},{b:40,s:1510},{b:50,s:1600}];
        function interp(val, inK, outK) {
            if(inK === 's' && val > 1600) val = 1600;
            if(inK === 'b' && val > 50) val = 50;
            for(let i=0; i<ANCHORS.length-1; i++){
                let l=ANCHORS[i], u=ANCHORS[i+1];
                if(val>=l[inK] && val<=u[inK]) return l[outK] + (val-l[inK])/(u[inK]-l[inK])*(u[outK]-l[outK]);
            }
            let last = ANCHORS[ANCHORS.length-1];
            if (val > last[inK]) return last[outK];
            return 0;
        }

        // --- PREDICTOR DATA ---
        const REAL_DB = [
            {c:'CLEAM', g:7.08, s:40.4, r:0}, {c:'CLEAM', g:7.50, s:39.7, r:1},
            {c:'CLEAM', g:7.25, s:39.0, sat:1490, r:1}, {c:'CLEAM', g:7.50, s:35.0, sat:1430, r:1},
            {c:'CLEAM', g:8.00, s:33.0, sat:1400, r:1}, 
            {c:'CLEAM', g:7.33, s:40.6, r:1}, {c:'CLEAM', g:7.80, s:40.0, r:1},
            {c:'CLEAM', g:7.85, s:39.4, r:1}, {c:'CLEAM', g:7.33, s:38.0, r:1},
            {c:'CLEAM', g:7.50, s:36.5, r:1}, {c:'CLEAM', g:8.16, s:35.0, r:1},
            {c:'CLEAM', g:8.40, s:33.1, r:1}, {c:'CLEAM', g:7.50, s:39.7, r:1},
            {c:'CLEAM', g:8.60, s:29.0, r:1}, {c:'CLEAM', g:8.75, s:28.5, r:1},
            {c:'CLEAM', g:7.75, s:40.0, sat:1510, r:1}, 
            {c:'CLEAM', g:8.00, s:30.5, sat:1360, r:0}, {c:'CLEAM', g:7.00, s:40.4, r:0},
            {c:'CLEAM', g:7.60, s:32.0, r:0}, {c:'CLEAM', g:7.25, s:37.6, r:0},
            {c:'BIEM', g:8.10, s:44.2, r:1},
            {c:'BIEM', g:8.33, s:40.7, r:1}, {c:'BIEM', g:8.75, s:38.0, r:1},
            {c:'BIEM', g:8.00, s:33.0, r:1}, {c:'BIEM', g:8.90, s:31.6, r:1},
            {c:'BIEM', g:8.00, s:39.0, sat:1490, r:0}, {c:'BIEM', g:8.00, s:35.0, sat:1430, r:0},
            {c:'BIEM', g:8.00, s:40.0, sat:1510, r:0}, {c:'BIEM', g:8.00, s:44.0, r:0},
            {c:'BIEF', g:9.17, s:36.5, r:1}, {c:'BIEF', g:8.90, s:36.5, r:1},
            {c:'BIEF', g:8.71, s:35.7, r:1}, 
            {c:'BEMACS', g:8.08, s:37.4, r:1}, {c:'BEMACS', g:8.88, s:43.7, r:1},
            {c:'BEMACS', g:8.50, s:47.6, r:1}, {c:'CLEACC', g:8.08, s:30.0, r:1},
            {c:'GLAW', g:7.30, s:37.2, r:1}
        ];

        const SCORE_THRESHOLDS = { "CLEAM": 52.5, "BIEM": 55.0, "BIEF": 60.0, "BEMACS": 56.0, "CLEACC": 47.5, "GLAW": 51.0 };

        function calcPred() {
            const course = document.getElementById('pred-course').value;
            let gpaVal = document.getElementById('pred-gpa').value.replace(',','.');
            let gpa = parseFloat(gpaVal);
            let rawScoreVal = document.getElementById('pred-score').value.replace(',','.');
            let rawScore = parseFloat(rawScoreVal);
            
            const resArea = document.getElementById('result-area');
            const badge = document.getElementById('res-badge');
            const title = document.getElementById('res-title');
            const desc = document.getElementById('res-desc');
            const matchBox = document.getElementById('data-match');
            const matchText = document.getElementById('match-text');

            if (!course || isNaN(gpa) || gpa < 6 || gpa > 10) { resArea.style.display = 'none'; return; }
            resArea.style.display = 'block';

            let pointsGPA = 45 * ((gpa - 6) / 4);
            const THRESHOLD = SCORE_THRESHOLDS[course];
            let effScore = null;
            let searchScore; 

            if(!isNaN(rawScore)) {
                if (rawScore >= 17 && rawScore <= 50) effScore = rawScore;
                else if (rawScore >= 1040 && rawScore <= 1600) effScore = interp(rawScore, 's', 'b');
                searchScore = effScore || 30; 
            }

            if(effScore === null) {
                let pointsNeeded = THRESHOLD - pointsGPA;
                if(pointsNeeded <= 0) {
                    badge.innerText = "Ammissione Probabile"; badge.style.color = "var(--success)";
                    title.innerText = "Media Eccellente";
                    desc.innerText = `Con media ${gpa}, parti da un vantaggio statistico notevole. Anche un test nella media dovrebbe bastare.`;
                    searchScore = 25;
                } else {
                    let targetVote = (pointsNeeded * 33 / 55) + 17;
                    searchScore = targetVote;
                    let minRange = Math.floor(targetVote);
                    let maxRange = Math.ceil(targetVote);
                    let rangeString = (minRange === maxRange) ? `${minRange}` : `${minRange} - ${maxRange}`;
                    
                    if(targetVote > 50) { rangeString = "Impossibile"; } else if (targetVote > 44) { rangeString = "> 45"; }

                    if(targetVote > 50) {
                        badge.innerText = "Matematicamente Difficile"; badge.style.color = "var(--text-sec)";
                        title.innerText = "Media Insufficiente";
                        desc.innerText = `Anche con un test perfetto, la media ${gpa} penalizza troppo il punteggio totale.`;
                    } else if(targetVote > 44) {
                        badge.innerText = "Sfida Estrema"; badge.style.color = "var(--danger)";
                        title.innerText = `Serve Test: ${rangeString}`;
                        desc.innerText = `Serve un punteggio eccezionale per compensare la media.`;
                    } else if(targetVote > 36) {
                        badge.innerText = "Difficile"; badge.style.color = "var(--warning)";
                        title.innerText = `Serve Test: ${rangeString}`;
                        desc.innerText = `Obiettivo alto. Dovrai superare nettamente la media dei candidati.`;
                    } else if(targetVote > 28) {
                        badge.innerText = "Competitivo"; badge.style.color = "var(--primary)";
                        title.innerText = `Serve Test: ${rangeString}`;
                        desc.innerText = `Con un buon test solido in questo range, hai le carte in regola per entrare.`;
                    } else {
                        badge.innerText = "Posizione Forte"; badge.style.color = "var(--success)";
                        title.innerText = `Serve Test: ${rangeString}`;
                        desc.innerText = `Hai un'ottima media. Ti basta un punteggio test standard per l'obiettivo.`;
                    }
                }
            } else {
                let pointsTest = 55 * ((effScore - 17) / 33);
                let totalScore = pointsGPA + pointsTest;
                searchScore = effScore;
                let gap = totalScore - THRESHOLD;
                let rejectionFound = false;
                let minSafeScore = 0;
                let coveredByAdmitted = false;

                REAL_DB.forEach(r => {
                    if (r.c === course && r.r === 0 && r.g >= (gpa - 0.1) && r.s > minSafeScore) { minSafeScore = r.s; rejectionFound = true; }
                    if (r.c === course && r.r === 1 && gpa >= r.g && effScore >= r.s) { coveredByAdmitted = true; }
                });
                
                if (rejectionFound && effScore <= minSafeScore && !coveredByAdmitted) {
                    badge.innerText = "A Rischio (Storico)"; badge.style.color = "var(--danger)";
                    title.innerText = "Punteggio Critico";
                    desc.innerText = "Candidati con profili simili al tuo sono stati rifiutati in passato.";
                } else if (gap >= 2) {
                    badge.innerText = "Probabile"; badge.style.color = "var(--success)";
                    title.innerText = "Posizionamento Solido";
                    desc.innerText = `Il tuo punteggio combinato risulta superiore alla soglia stimata. Buone possibilit√†.`;
                } else if (gap >= 0) {
                    badge.innerText = "Competitivo"; badge.style.color = "var(--warning)";
                    title.innerText = "Sulla Soglia";
                    desc.innerText = "Sei tecnicamente dentro la soglia, ma il margine √® minimo.";
                } else {
                    if (coveredByAdmitted) {
                        badge.innerText = "Competitivo (Storico Favorevole)"; badge.style.color = "var(--warning)";
                        title.innerText = "Sotto Media ma Possibile";
                        desc.innerText = "Punteggio basso, ma in passato casi simili sono stati ammessi.";
                    } else {
                        badge.innerText = "Insufficiente"; badge.style.color = "var(--danger)";
                        title.innerText = "Sotto Target";
                        desc.innerText = `Combinazione inferiore alla soglia statistica necessaria.`;
                    }
                }
            }
            let bestRecord = null;
            let minDist = Infinity;
            REAL_DB.forEach(r => {
                if(r.c === course || (course === 'BEMACS' && r.c === 'BAI')) { 
                    let dG = (r.g - gpa) * 10; 
                    let dS = (r.s - searchScore);
                    let dist = Math.sqrt(dG*dG + dS*dS);
                    if(dist < minDist) { minDist = dist; bestRecord = r; }
                }
            });
            if (bestRecord && minDist < 15) { 
                matchBox.style.display = 'block';
                let tagHtml = bestRecord.r === 1 ? '<span class="match-tag tag-ok">Ammesso</span>' : '<span class="match-tag tag-ko">Non Ammesso</span>';
                let scoreText = bestRecord.sat ? `SAT ${bestRecord.sat}` : `Test ${bestRecord.s.toFixed(1)}`;
                matchText.innerHTML = `Media ${bestRecord.g} + ${scoreText} ${tagHtml}`;
            } else { matchBox.style.display = 'none'; }
        }

        // --- PREP LUISS LOGIC ---
        const SET_NAMES = [
            "Ragionamento Critico-Verbale", "Analisi Matematica & Problemi", "Comprensione del Testo", 
            "Logica Insiemistica & Sillogismi", "Serie Numeriche & Problem Solving", "Deduzioni Logiche Complesse",
            "Geometria Piana & Solida", "Proporzioni & Calcolo", "Esercizi Misti (A)", "Esercizi Misti (B)"
        ];

        // CORREZIONE DELLE DOMANDE (Testo reso esplicito)
        const RAW_SETS = [
            [ // SET 1: Critical Verbal Reasoning (Beliefs & Conditionals)
                {t: "Giulio crede che per accedere alla borsa di studio sia necessario avere un ISEE inferiore a 20.000‚Ç¨ E una media voto superiore a 28. Il bando rettificato afferma che per accedere √® sufficiente soddisfare almeno una delle due condizioni. Questa informazione:", o: ["Smentisce/Va contro la convinzione di Giulio", "Conferma la convinzione di Giulio", "Non ha influenza sulla convinzione", "Restringe il campo dei beneficiari"], c: 0},
                {t: "Luca √® convinto che il treno 9605 fermi in tutte le stazioni dell'alta velocit√†. Un annuncio in stazione specifica che il treno 9605 ferma solo nelle stazioni capoluogo di regione, saltando le intermedie. L'annuncio:", o: ["Va contro la convinzione di Luca", "Conferma la convinzione di Luca", "Non ha influenza", "√à un'informazione ridondante"], c: 0},
                {t: "Se e solo se il tasso di interesse scende, Mario comprer√† casa. Sappiamo che Mario non ha comprato casa. Cosa possiamo dedurre con certezza?", o: ["Il tasso di interesse non √® sceso", "Il tasso di interesse √® salito", "Mario non aveva abbastanza soldi", "Il tasso √® sceso ma Mario ha cambiato idea"], c: 0},
                {t: "Qual √® la negazione logica della frase: 'Tutti i candidati ammessi hanno superato il test O hanno presentato una certificazione linguistica'?", o: ["Esiste almeno un candidato ammesso che non ha superato il test E non ha certificazione", "Nessun candidato ammesso ha superato il test", "Tutti i candidati ammessi non hanno certificazione", "Alcuni candidati non sono stati ammessi pur avendo la certificazione"], c: 0},
                {t: "Anna crede che il nuovo iPhone sia disponibile SOLO in titanio naturale. Il commesso le mostra il catalogo dove appare ANCHE la colorazione titanio blu. Questo fatto:", o: ["Va contro la convinzione di Anna", "Conferma la convinzione", "Non ha influenza", "√à un dettaglio irrilevante"], c: 0},
                {t: "√à condizione necessaria ma non sufficiente per passare l'esame studiare il libro di testo. Marco ha studiato il libro di testo. Dunque:", o: ["Marco potrebbe non passare l'esame", "Marco passer√† sicuramente l'esame", "Marco non passer√† l'esame", "Marco prender√† un voto basso"], c: 0},
                {t: "Condizione sufficiente affinch√© il numero sia divisibile per 6 √® che sia divisibile per 12. Il numero X NON √® divisibile per 6. Dunque:", o: ["X non √® divisibile per 12", "X √® divisibile per 12", "X √® dispari", "X √® divisibile per 3"], c: 0},
                {t: "Silvia crede che suo fratello non abbia mai viaggiato fuori dall'Europa. Trova nel cassetto del fratello un biglietto aereo usato per Tokyo. Questo ritrovamento:", o: ["Smentisce la credenza di Silvia", "Conferma la credenza", "Non influenza la credenza", "Indica che il fratello vuole viaggiare"], c: 0},
                {t: "Se √® FALSO che 'Nessun dipendente parla sia inglese che tedesco', allora √® VERO che:", o: ["Almeno un dipendente parla sia inglese che tedesco", "Tutti i dipendenti parlano entrambe le lingue", "Nessun dipendente parla solo inglese", "Tutti parlano tedesco"], c: 0},
                {t: "Claudio crede che la farmacia di turno sia quella in Piazza Roma. Un passante gli dice che la farmacia di Piazza Roma √® chiusa per ristrutturazione. Questa notizia:", o: ["Va contro la convinzione di Claudio", "Conferma la convinzione", "Non ha influenza", "√à un'opinione soggettiva"], c: 0}
            ],
            [ // SET 2: Math Analysis & Word Problems
                {t: "Una catena di montaggio ha 4 macchinari. Il primo produce 5 pezzi. Ogni macchinario successivo produce il doppio del precedente meno 2 pezzi. Quanti pezzi produce il quarto macchinario?", o: ["26", "28", "24", "30"], c: 0}, 
                {t: "Il prezzo di un bene aumenta del 30% e poi il nuovo prezzo viene scontato del 20%. Rispetto al prezzo iniziale, qual √® la variazione percentuale complessiva?", o: ["Aumento del 4%", "Aumento del 10%", "Diminuzione del 4%", "Aumento del 6%"], c: 0},
                {t: "Tre soci dividono un utile di 12.000‚Ç¨. Il secondo prende il doppio del primo. Il terzo prende quanto il primo e il secondo messi insieme. Quanto spetta al terzo?", o: ["6.000‚Ç¨", "4.000‚Ç¨", "8.000‚Ç¨", "3.000‚Ç¨"], c: 0}, 
                {t: "Un rettangolo ha base B e altezza H. Se B aumenta del 10% e H diminuisce del 10%, come cambia l'area?", o: ["Diminuisce dell'1%", "Resta invariata", "Aumenta dell'1%", "Diminuisce del 10%"], c: 0},
                {t: "5 stampanti producono 500 pagine in 10 minuti. Quanti minuti impiegano 10 stampanti (della stessa velocit√†) a produrre 2000 pagine?", o: ["20 minuti", "40 minuti", "10 minuti", "30 minuti"], c: 0},
                {t: "L'equazione y = 3x/5 pu√≤ essere scritta come proporzione:", o: ["x : y = 5 : 3", "x : 5 = y : 3", "y : x = 5 : 3", "3 : x = 5 : y"], c: 0},
                {t: "Un serbatoio perde il 20% del suo contenuto ogni ora rispetto all'ora precedente. Se parte da 100 litri, quanto contiene dopo 2 ore?", o: ["64 litri", "60 litri", "80 litri", "72 litri"], c: 0},
                {t: "In una libreria ci sono libri Gialli, Fantasy e Storici. I Gialli sono 1/3 del totale. I Fantasy sono 3/4 dei rimanenti. Se ci sono 20 libri Storici, quanti libri ci sono in totale?", o: ["120", "100", "80", "240"], c: 0},
                {t: "La media di 5 numeri √® 30. Se aggiungiamo un sesto numero pari a 60, quanto vale la nuova media?", o: ["35", "40", "45", "32"], c: 0},
                {t: "Un cubo di lato L ha volume V. Se il lato raddoppia (2L), il nuovo volume sar√†:", o: ["8V", "4V", "2V", "6V"], c: 0}
            ],
            [ // SET 3: Reading Comprehension (Inference focus)
                {
                    reading: "Il 'Nudging', o spinta gentile, √® un concetto dell'economia comportamentale che propone di influenzare le decisioni delle persone senza proibire opzioni o cambiare significativamente gli incentivi economici. A differenza della legislazione coercitiva, il nudge altera l'architettura delle scelte per rendere l'opzione desiderabile pi√π accessibile, sfruttando i bias cognitivi umani anzich√© combatterli.",
                    t: "Secondo il brano, quale differenza sostanziale esiste tra 'Nudging' e legislazione coercitiva?", o: ["Il Nudging preserva la libert√† di scelta formale, la coercizione no", "Il Nudging usa incentivi economici forti, la coercizione no", "La coercizione sfrutta i bias cognitivi, il Nudging li combatte", "Non c'√® differenza, entrambi obbligano alla scelta"], c: 0
                },
                {
                    reading: "L'inflazione da costi si verifica quando aumentano i prezzi dei fattori produttivi, come materie prime o energia, indipendentemente dalla domanda aggregata. Questo porta a una contrazione dell'offerta: le imprese, per mantenere i margini, alzano i prezzi. Un esempio √® lo shock petrolifero. Al contrario, l'inflazione da domanda deriva da un eccesso di spesa rispetto alla capacit√† produttiva.",
                    t: "In uno scenario di inflazione da costi, in base al testo, ci si aspetta tipicamente:", o: ["Aumento dei prezzi e possibile riduzione della produzione", "Aumento della produzione per coprire i costi", "Riduzione dei prezzi per stimolare la domanda", "Un eccesso di spesa dei consumatori"], c: 0
                },
                {
                    reading: "Gli studi sull'epigenetica dimostrano che l'ambiente pu√≤ influenzare l'espressione genica senza alterare la sequenza del DNA. Fattori come dieta e stress possono aggiungere marcatori chimici, attivando o disattivando geni. Queste modifiche possono essere ereditabili, suggerendo che le esperienze di una generazione possono avere ripercussioni biologiche su quelle successive.",
                    t: "L'epigenetica mette in discussione l'idea che:", o: ["Solo le mutazioni nella sequenza del DNA siano ereditabili", "L'ambiente non abbia alcun ruolo nella biologia", "Il DNA sia una struttura chimica instabile", "Lo stress sia puramente psicologico"], c: 0
                },
                {
                    reading: "Il Barocco si contrappone al Rinascimento per l'uso della linea curva e della teatralit√†. L'obiettivo non √® l'armonia statica, ma il coinvolgimento emotivo dello spettatore attraverso illusioni ottiche e prospettive ardite. Bernini e Borromini incarnano due anime: il primo trionfale, il secondo inquieto e geometricamente complesso.",
                    t: "L'affermazione 'Il Barocco cerca l'armonia statica e razionale' √®:", o: ["Falsa, contraddice il testo", "Vera, deducibile dal testo", "Non ricavabile dal testo", "Vera solo per Borromini"], c: 0
                },
                {
                    reading: "Il principio di indeterminazione di Heisenberg pone un limite alla precisione con cui si possono misurare coppie di propriet√† fisiche coniugate. Non √® un limite tecnologico, ma intrinseco alla natura ondulatoria della materia. Pi√π precisa √® la misura della posizione, meno precisa sar√† quella della quantit√† di moto.",
                    t: "Secondo il testo, migliorare la tecnologia di misurazione:", o: ["Non permetter√† di superare il limite di indeterminazione", "Risolver√† il problema dell'indeterminazione", "Render√† la materia meno ondulatoria", "Permetter√† di misurare posizione e velocit√† con precisione infinita"], c: 0
                },
                {
                    reading: "(Stesso brano Nudging) Il Nudging agisce:",
                    t: "In base al brano, il Nudging agisce principalmente:", o: ["Modificando l'architettura delle scelte", "Imponendo multe salate", "Vietando le opzioni nocive", "Educando razionalmente i cittadini"], c: 0
                },
                {
                    reading: "(Stesso brano Epigenetica) I marcatori chimici citati:",
                    t: "I marcatori chimici citati nel testo:", o: ["Non alterano la sequenza base del DNA", "Cancellano parti di DNA", "Sono irreversibili", "Non dipendono dall'ambiente"], c: 0
                },
                {
                    reading: "(Stesso brano Inflazione) L'inflazione da domanda √® causata da:",
                    t: "Secondo il testo, l'inflazione da domanda √® causata da:", o: ["Eccesso di spesa rispetto alla capacit√† produttiva", "Aumento del costo del petrolio", "Contrazione dell'offerta aggregata", "Tasse troppo alte"], c: 0
                },
                {
                    reading: "(Stesso brano Barocco) Borromini si distingue da Bernini per:",
                    t: "Borromini si distingue da Bernini per:", o: ["Uno stile pi√π inquieto e complesso", "L'uso esclusivo di linee rette", "Il rifiuto del Barocco", "La ricerca dell'armonia statica"], c: 0
                },
                {
                    reading: "(Stesso brano Heisenberg) Il limite descritto √®:",
                    t: "Il limite descritto da Heisenberg √® definito come:", o: ["Intrinseco alla natura della materia", "Dovuto a strumenti imperfetti", "Applicabile solo alla luce", "Superabile nel futuro"], c: 0
                }
            ],
            [ // SET 4: Logic Sets & Syllogisms
                {t: "In un ufficio di 100 persone: 40 parlano Inglese, 30 Francese, 10 entrambe. Quanti non parlano n√© Inglese n√© Francese?", o: ["40", "20", "30", "50"], c: 0},
                {t: "Tutti gli A sono B. Nessun B √® C. Alcuni D sono A. Quale conclusione √® certa?", o: ["Nessun A √® C", "Tutti i D sono B", "Alcuni C sono A", "Nessun D √® C"], c: 0},
                {t: "Se √® vero che 'Nessun filosofo √® ignorante', allora √® sicuramente vero che:", o: ["Non esistono ignoranti che siano filosofi", "Tutti gli ignoranti sono filosofi", "Alcuni filosofi sono ignoranti", "Chi non √® filosofo √® ignorante"], c: 0},
                {t: "In una biblioteca, i libri di Storia sono il doppio dei Romanzi. I Romanzi sono il triplo dei Fumetti. Se i Fumetti sono 10, quanti sono i libri di Storia?", o: ["60", "30", "20", "90"], c: 0},
                {t: "Quale diagramma rappresenta meglio la relazione tra: Mammiferi, Cani, Rettili?", o: ["Un insieme grande (Mammiferi) che include Cani; Rettili disgiunto", "Tre insiemi intersecati", "Tre insiemi concentrici", "Tre insiemi separati"], c: 0},
                {t: "Se X √® sottoinsieme di Y, e Y non ha elementi in comune con Z, allora si deduce che:", o: ["X non ha elementi in comune con Z", "X ha elementi in comune con Z", "X unito Z √® uguale a Y", "Z √® sottoinsieme di X"], c: 0},
                {t: "In un club, il 60% gioca a Tennis, il 50% a Golf. Qual √® la percentuale minima di chi pratica entrambi (supponendo che tutti facciano almeno uno sport)?", o: ["10%", "20%", "0%", "30%"], c: 0},
                {t: "La negazione logica di 'Tutti i giorni vado in palestra e mangio sano' √®:", o: ["Almeno un giorno non vado in palestra O non mangio sano", "Nessun giorno vado in palestra", "Tutti i giorni non mangio sano", "Almeno un giorno non vado in palestra E non mangio sano"], c: 0},
                {t: "Premessa: Tutti i medici sono laureati. Premessa: Alcuni laureati sono disoccupati. Dunque:", o: ["Non si pu√≤ concludere che alcuni medici siano disoccupati", "Alcuni medici sono disoccupati", "Tutti i medici lavorano", "Nessun disoccupato √® laureato"], c: 0},
                {t: "Se 'Chi dorme non piglia pesci' √® vera, e 'Luigi ha preso pesci', allora:", o: ["Luigi non dormiva", "Luigi dormiva", "Luigi √® un pescatore", "Luigi √® fortunato"], c: 0}
            ],
            [ // SET 5: Series & Problem Solving
                {t: "Completare la serie numerica: 2, 5, 11, 23, 47, ...", o: ["95", "94", "92", "88"], c: 0},
                {t: "Individuare il numero mancante: 144, 121, 100, 81, ...", o: ["64", "49", "60", "72"], c: 0},
                {t: "Un treno lungo 150m entra in una galleria lunga 850m alla velocit√† di 50 m/s. Quanto tempo passa dall'ingresso della locomotiva all'uscita dell'ultimo vagone?", o: ["20 secondi", "17 secondi", "25 secondi", "15 secondi"], c: 0},
                {t: "Una cassaforte ha un codice di 3 cifre. La prima √® pari, la seconda √® il doppio della prima, la terza √® la somma delle prime due. Qual √® il codice se la somma totale delle cifre √® 21?", o: ["Impossibile, nessuna combinazione valida", "4812 (non valido)", "246", "61218 (non valido)"], c: 0}, 
                {t: "Individuare l'intruso semantico: Violino, Chitarra, Arpa, Flauto.", o: ["Flauto (fiato, gli altri corde)", "Violino", "Chitarra", "Arpa"], c: 0},
                {t: "Se ROMA = 4, MILANO = 6, TORINO = 6, allora PISA = ?", o: ["4", "5", "3", "2"], c: 0},
                {t: "Un orologio analogico perde 10 minuti ogni ora. Viene regolato a mezzanotte. Quando l'orologio segner√† le 05:00, che ora sar√† realmente?", o: ["06:00", "05:50", "04:10", "05:30"], c: 0},
                {t: "Anagrammando la parola NOGALOB si ottiene il nome di una citt√†. Quale?", o: ["BOLOGNA", "ANCONA", "GENOVA", "BERGAMO"], c: 0},
                {t: "Quante password diverse di 2 lettere (alfabeto 21 lettere) posso formare se le lettere NON possono ripetersi?", o: ["420", "441", "400", "210"], c: 0},
                {t: "In una gara di corsa superi il secondo. In che posizione sei?", o: ["Secondo", "Primo", "Terzo", "Penultimo"], c: 0}
            ],
            [ // SET 6: Complex Deductions (Logic B)
                {t: "Se A implica B (A -> B), e B √® falso, allora necessariamente:", o: ["A √® falso", "A √® vero", "Non si pu√≤ sapere A", "A diventa vero"], c: 0},
                {t: "'Non √® vero che Luca non ha mancato l'appuntamento'. Significa che:", o: ["Luca ha mancato l'appuntamento", "Luca √® andato all'appuntamento", "Luca era in ritardo", "Luca non aveva appuntamenti"], c: 0},
                {t: "Tutti gli scienziati sono curiosi. Andrea non √® curioso. Dunque:", o: ["Andrea non √® uno scienziato", "Andrea √® uno scienziato distratto", "Andrea potrebbe essere scienziato", "Chi √® curioso √® scienziato"], c: 0},
                {t: "Solo se c'√® vento faccio surf. Oggi faccio surf. Dunque:", o: ["C'√® vento", "Non c'√® vento", "Forse c'√® vento", "Il mare √® calmo"], c: 0},
                {t: "Chi rompe paga. Giovanni non ha pagato. Dunque:", o: ["Giovanni non ha rotto nulla", "Giovanni ha rotto", "Giovanni non ha soldi", "Non si pu√≤ dire"], c: 0},
                {t: "Nessun A √® B. Tutti i C sono A. Dunque:", o: ["Nessun C √® B", "Qualche C √® B", "Tutti i B sono C", "Nessun B √® A (ridondante)"], c: 0},
                {t: "Se X > Y e Y < Z, allora:", o: ["Non si pu√≤ stabilire la relazione tra X e Z", "X > Z", "X < Z", "X = Z"], c: 0},
                {t: "La frase 'Se non piove, esco' √® logicamente equivalente a:", o: ["Se non esco, allora piove", "Se esco, allora non piove", "Se piove, non esco", "Se non piove, non esco"], c: 0},
                {t: "O studi o vieni bocciato. Non sono stato bocciato. Dunque:", o: ["Ho studiato", "Non ho studiato", "Il professore √® gentile", "Ho copiato"], c: 0},
                {t: "Il paradosso del mentitore: Se dico 'Io sto mentendo', sto dicendo la verit√† o mentendo?", o: ["√à indecidibile (paradosso)", "Verit√†", "Menzogna", "Nessuna delle due"], c: 0}
            ],
            [ // SET 7: Geometry (Area, Perimeter, Coordinates)
                {t: "Un quadrato ha diagonale pari a 6‚àö2 cm. Qual √® il suo perimetro?", o: ["24 cm", "12 cm", "36 cm", "18 cm"], c: 0},
                {t: "Un rettangolo ha area 48 e un lato √® il triplo dell'altro. Quanto misura il lato minore?", o: ["4", "12", "6", "8"], c: 0},
                {t: "Il rapporto tra il volume di un cubo di lato L e quello di un cubo di lato 3L √®:", o: ["1 : 27", "1 : 9", "1 : 3", "1 : 6"], c: 0},
                {t: "La somma degli angoli interni di un esagono regolare √®:", o: ["720¬∞", "540¬∞", "360¬∞", "900¬∞"], c: 0},
                {t: "L'area di una corona circolare compresa tra due cerchi di raggio 10 e 8 √®:", o: ["36œÄ", "64œÄ", "100œÄ", "18œÄ"], c: 0},
                {t: "In un triangolo rettangolo i cateti misurano 9 e 12. L'ipotenusa √®:", o: ["15", "13", "18", "21"], c: 0},
                {t: "Se il raggio di una sfera triplica, il suo volume diventa:", o: ["27 volte pi√π grande", "9 volte pi√π grande", "3 volte pi√π grande", "6 volte pi√π grande"], c: 0},
                {t: "Quante diagonali ha un decagono (10 lati)? Formula: n(n-3)/2.", o: ["35", "20", "27", "40"], c: 0},
                {t: "Due rette perpendicolari nel piano cartesiano hanno coefficienti angolari m1 e m2 tali che:", o: ["m1 * m2 = -1", "m1 = m2", "m1 * m2 = 1", "m1 = -m2"], c: 0},
                {t: "La distanza tra i punti A(1, 2) e B(4, 6) √®:", o: ["5", "4", "6", "7"], c: 0}
            ],
            [ // SET 8: Calculations & Proportions
                {t: "0.04 * 0.05 =", o: ["0.002", "0.02", "0.2", "0.0002"], c: 0},
                {t: "Qual √® la radice cubica di 0.027?", o: ["0.3", "0.03", "0.09", "0.003"], c: 0},
                {t: "(2^3)^2 diviso 2^4 vale:", o: ["4", "8", "2", "16"], c: 0},
                {t: "Il 20% del 30% di X √® uguale a 6. Quanto vale X?", o: ["100", "60", "200", "300"], c: 0},
                {t: "Un'auto viaggia a 90 km/h. Quanti metri percorre in 2 secondi?", o: ["50 metri", "25 metri", "45 metri", "60 metri"], c: 0},
                {t: "Il MCD tra 24, 36 e 60 √®:", o: ["12", "6", "24", "4"], c: 0},
                {t: "Il mcm tra 5, 6 e 8 √®:", o: ["120", "60", "240", "40"], c: 0},
                {t: "3/4 + 1/2 - 5/8 =", o: ["5/8", "1/2", "3/8", "7/8"], c: 0},
                {t: "Se 4 operai costruiscono un muro in 9 ore, in quanto tempo lo costruirebbero 6 operai?", o: ["6 ore", "12 ore", "5 ore", "8 ore"], c: 0},
                {t: "Un capitale di 100‚Ç¨ investito al 10% annuo composto diventa dopo 2 anni:", o: ["121‚Ç¨", "120‚Ç¨", "110‚Ç¨", "130‚Ç¨"], c: 0}
            ],
            [ // SET 9: Mixed Hard A
                {t: "Mario crede che per votare serva la scheda elettorale. Al seggio gli dicono che serve anche un documento di identit√† valido. L'informazione ricevuta al seggio:", o: ["Va contro la convinzione di Mario (era incompleta)", "Conferma la convinzione", "Non ha influenza", "√à falso"], c: 0},
                {t: "Area di un triangolo equilatero di lato 4. Formula: (l¬≤‚àö3)/4.", o: ["4‚àö3", "8", "16", "2‚àö3"], c: 0},
                {t: "Serie alfabetica: Z, V, R, N, ... (passo indietro)", o: ["J", "K", "I", "L"], c: 0},
                {t: "Contrario di 'Opulento':", o: ["Misero", "Ricco", "Fastoso", "Eccessivo"], c: 0},
                {t: "Se l'intersezione tra A e B √® vuota, allora:", o: ["A e B non hanno elementi comuni", "A √® uguale a B", "A √® vuoto", "B √® vuoto"], c: 0},
                {t: "Il 150% di 40 √®:", o: ["60", "50", "80", "100"], c: 0},
                {t: "Se 3x - 5 = x + 7, allora x vale:", o: ["6", "5", "4", "7"], c: 0},
                {t: "Rapporto tra 0.5 e 0.05", o: ["10", "100", "1", "0.1"], c: 0},
                {t: "Un anno non bisestile ha:", o: ["365 giorni", "366 giorni", "364 giorni", "360 giorni"], c: 0},
                {t: "Negazione di 'Nessun studente √® bocciato':", o: ["Almeno uno studente √® bocciato", "Tutti sono bocciati", "Tutti sono promossi", "Nessuno √® promosso"], c: 0}
            ],
            [ // SET 10: Mixed Hard B
                {t: "Se il diametro di un cerchio triplica, l'area:", o: ["Diventa 9 volte maggiore", "Triplica", "Diventa 6 volte maggiore", "Raddoppia"], c: 0},
                {t: "Probabilit√† di estrarre un Asso o un Re da un mazzo di 52 carte.", o: ["2/13", "1/13", "1/52", "4/13"], c: 0},
                {t: "Giulia crede che il museo apra alle 9. Il cartello dice 'Apertura 10:00'. Il cartello:", o: ["Va contro la convinzione di Giulia", "Conferma la convinzione", "Non ha influenza", "√à ambigua"], c: 0},
                {t: "Sinonimo di 'Lapalissiano'", o: ["Ovvio", "Complesso", "Segreto", "Antico"], c: 0},
                {t: "5/6 di 120", o: ["100", "90", "110", "80"], c: 0},
                {t: "Diagonale di un rettangolo con lati 6 e 8.", o: ["10", "12", "14", "9"], c: 0},
                {t: "Se non pago la bolletta, staccano la luce. La luce funziona. Dunque:", o: ["Potrei aver pagato la bolletta (o errore sistema)", "Ho pagato sicuramente", "Non ho pagato", "Hanno staccato l'acqua"], c: 0}, 
                {t: "Risolvere: (x/2) + 3 = 8", o: ["10", "5", "16", "6"], c: 0},
                {t: "Sconto del 20% su 80‚Ç¨, poi ulteriore sconto del 10%. Prezzo finale?", o: ["57.6‚Ç¨", "56‚Ç¨", "54‚Ç¨", "58‚Ç¨"], c: 0},
                {t: "Prossimo numero: 1, 4, 9, 16, 25...", o: ["36", "30", "40", "49"], c: 0}
            ]
        ];

        let currentSetIndex = 0;
        let activeQuestions = [];
        let userAnswers = []; // -1 = skipped, index = selected
        let currentQIdx = 0;
        let quizTimer = 900;
        let quizInterval = null;
        let selectedOption = null;

        // --- PREP LUISS: INIT MENU ---
        const setContainer = document.getElementById('sets-container');
        SET_NAMES.forEach((name, idx) => {
            const div = document.createElement('div');
            div.className = 'menu-item';
            div.onclick = () => startLuissSet(idx);
            div.innerHTML = `
                <div class="menu-icon" style="background: var(--luiss-light); color: var(--luiss-blue); font-size:14px;">${idx+1}</div>
                <div class="menu-content">
                    <h3>${name}</h3>
                </div>
            `;
            setContainer.appendChild(div);
        });

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startLuissSet(idx) {
            isQuizActive = true;
            currentSetIndex = idx;
            
            activeQuestions = RAW_SETS[idx].map(q => {
                let mappedOptions = q.o.map((txt, i) => ({ text: txt, isCorrect: (i === q.c) }));
                shuffleArray(mappedOptions);
                return {
                    text: q.t,
                    reading: q.reading || null,
                    options: mappedOptions
                };
            });

            userAnswers = new Array(10).fill(null); 
            currentQIdx = 0;
            quizTimer = 900;
            selectedOption = null;
            
            goTo('view-luiss-quiz');
            updateTimerDisplay();
            renderLuissQuestion();
            
            if(quizInterval) clearInterval(quizInterval);
            quizInterval = setInterval(() => {
                quizTimer--;
                updateTimerDisplay();
                if(quizTimer <= 0) {
                    finishLuissTest(true);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            let m = Math.floor(quizTimer / 60);
            let s = quizTimer % 60;
            document.getElementById('quiz-timer').innerText = `${m}:${s<10?'0':''}${s}`;
            if(quizTimer < 60) document.getElementById('quiz-timer').style.color = "var(--danger)";
            else document.getElementById('quiz-timer').style.color = "var(--luiss-blue)";
        }

        function renderLuissQuestion() {
            selectedOption = null;
            let q = activeQuestions[currentQIdx];
            
            // Gestione testo lettura
            const readingBox = document.getElementById('luiss-reading-text');
            if(q.reading) {
                readingBox.style.display = 'block';
                readingBox.innerText = q.reading;
            } else {
                readingBox.style.display = 'none';
            }

            document.getElementById('quiz-progress').innerText = `${currentQIdx + 1} / 10`;
            document.getElementById('luiss-q-text').innerText = q.text;
            
            // Render Opzioni
            let html = '';
            q.options.forEach((optObj, i) => {
                html += `<div class="quiz-opt-btn" id="opt-btn-${i}" onclick="selectLuissOpt(this, ${i})">
                    <div class="quiz-marker"></div>
                    <div>${optObj.text}</div>
                </div>`;
            });
            document.getElementById('luiss-options').innerHTML = html;

            // Ripristina selezione se gi√† risposta
            if(userAnswers[currentQIdx] !== null && userAnswers[currentQIdx] !== -1) {
                const prevSelIdx = userAnswers[currentQIdx];
                const btn = document.getElementById(`opt-btn-${prevSelIdx}`);
                if(btn) selectLuissOpt(btn, prevSelIdx);
            }

            // Visibilit√† pulsante Indietro
            document.getElementById('btn-prev').style.visibility = (currentQIdx === 0) ? 'hidden' : 'visible';
        }

        function selectLuissOpt(el, idx) {
            document.querySelectorAll('.quiz-opt-btn').forEach(b => b.classList.remove('selected'));
            document.querySelectorAll('.quiz-marker').forEach(m => m.style.backgroundColor = '#fff');
            
            el.classList.add('selected');
            el.querySelector('.quiz-marker').style.backgroundColor = 'var(--luiss-blue)';
            selectedOption = idx;
        }

        function prevQuestion() {
            if(currentQIdx > 0) {
                currentQIdx--;
                renderLuissQuestion();
            }
        }

        function skipLuissQuestion() {
            userAnswers[currentQIdx] = -1;
            nextQuestion();
        }

        function submitLuissAnswer() {
            if(selectedOption !== null) {
                userAnswers[currentQIdx] = selectedOption;
            } else if (userAnswers[currentQIdx] === null) {
                return; // Richiede selezione
            }
            nextQuestion();
        }

        function nextQuestion() {
            currentQIdx++;
            if(currentQIdx < 10) {
                renderLuissQuestion();
            } else {
                finishLuissTest(false);
            }
        }

        function abortQuiz() {
            if(confirm("Sei sicuro di voler annullare il set? Perderai i progressi.")) {
                isQuizActive = false;
                clearInterval(quizInterval);
                goTo('view-luiss-menu');
            }
        }

        function finishLuissTest(timeout) {
            isQuizActive = false;
            clearInterval(quizInterval);
            goTo('view-luiss-result');
            
            let correct = 0;
            let wrong = 0;
            let skipped = 0;
            
            userAnswers.forEach((userSelIndex, qIdx) => {
                if (userSelIndex === -1 || userSelIndex === null) {
                    skipped++;
                } else {
                    if (activeQuestions[qIdx].options[userSelIndex].isCorrect) {
                        correct++;
                    } else {
                        wrong++;
                    }
                }
            });

            document.getElementById('final-score-title').innerText = `${correct}/10`;
            document.getElementById('stat-correct').innerText = correct;
            document.getElementById('stat-wrong').innerText = wrong;
            document.getElementById('stat-skipped').innerText = skipped;
            
            let msg = document.getElementById('final-score-msg');
            if(timeout) msg.innerText = "Tempo scaduto.";
            else if(correct >= 9) msg.innerHTML = "Eccellente. Preparazione solida.";
            else if(correct >= 7) msg.innerHTML = "Buon risultato. Sopra la media.";
            else if(correct >= 5) msg.innerHTML = "Discreto. Margine di miglioramento.";
            else msg.innerHTML = "Punteggio insufficiente. Necessario ripasso.";
        }

        function showReview() {
            goTo('view-luiss-review');
            const container = document.getElementById('review-container');
            container.innerHTML = '';
            
            activeQuestions.forEach((q, qIdx) => {
                const userSelIndex = userAnswers[qIdx];
                const isSkipped = (userSelIndex === -1 || userSelIndex === null);
                
                let isAnswerCorrect = false;
                if (!isSkipped && q.options[userSelIndex].isCorrect) isAnswerCorrect = true;

                let statusClass = isSkipped ? 'status-skipped' : (isAnswerCorrect ? 'status-correct' : 'status-wrong');
                
                let optsHtml = '';
                q.options.forEach((optObj, optIdx) => {
                    let className = 'review-opt';
                    if (optObj.isCorrect) className += ' is-correct';
                    if (!isSkipped && optIdx === userSelIndex && !optObj.isCorrect) className += ' is-wrong';
                    
                    optsHtml += `<div class="${className}">${optObj.text}</div>`;
                });
                
                let readingRef = q.reading ? `<div style="font-size:12px; color:var(--text-sec); margin-bottom:8px; font-style:italic;">Basato sul brano letto precedentemente.</div>` : '';

                const itemDiv = document.createElement('div');
                itemDiv.className = `review-item ${statusClass}`;
                itemDiv.innerHTML = `
                    <div class="review-q">${q.text}</div>
                    ${readingRef}
                    ${optsHtml}
                `;
                container.appendChild(itemDiv);
            });
        }

    </script>
</body>
</html>
